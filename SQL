"DEMO_DB"."PUBLIC"."MYTABLE"




SELECT * FROM "DEMO_DB"."INFORMATION_SCHEMA".TABLES WHERE TABLE_NAME  = 'MY_TABLE'



CREATE TABLE MY_TABLE (AMOUNT NUMBER , NAME VARCHAR(50));

INSERT INTO MY_TABLE VALUES(1 , 'PARKASH');

SELECT * FROM MY_TABLE;

CREATE OR REPLACE TABLE METRIC (TABLE_NAME VARCHAR(50) , METRIC NUMBER );

SELECT * FROM METRIC;

INSERT INTO   METRIC (TABLE_NAME , METRIC)
VALUES 
( 'NAME' , ( SELECT COUNT(*) FROM MY_TABLE WHERE NAME IN ( 'PARKASH','parkash' ) ) ) ,
( 'NAME' , ( SELECT COUNT(*) FROM MY_TABLE WHERE NAME = 'PARKASH' ) ) ,
( 'NAME' , ( SELECT COUNT(*) FROM MY_TABLE WHERE AMOUNT = 1 ) ) 



INSERT INTO   
METRIC (TABLE_NAME , METRIC)
VALUES 
( 'NAME' , ( SELECT COUNT(*) FROM DEMO_DB.PUBLIC.MYTABLE AS T1 WHERE T1.AMOUNT = 12  ) ) 


INSERT INTO   METRIC (TABLE_NAME , METRIC)
VALUES 
( 'NAME' , (SELECT CASE WHEN COUNT(*) = 0 then 0 ELSE COUNT(*) END AS METRIC FROM MY_TABLE AS T1 WHERE T1.AMOUNT = 12 ) ) 

SELECT CASE WHEN COUNT(*) = false then 0 ELSE COUNT(*) END AS KOUNT FROM MY_TABLE AS T1 WHERE T1.AMOUNT = 1

SELECT 
CASE 
    WHEN COUNT(*) = 0 then 0
    ELSE COUNT(*)
END AS KOUNT 
FROM MY_TABLE AS T1 WHERE T1.AMOUNT = 1




















CREATE OR REPLACE FUNCTION ADD5 (N NUMBER)
  RETURNS NUMBER
  AS 'N + 5';

SELECT ADD5(5);




CREATE OR REPLACE FUNCTION METRIC( AMOUNT NUMBER)
  RETURNS NUMERIC(11, 2)
  AS
  $$
			SELECT 
			CASE 
			    WHEN COUNT(*) = 0 then 0
			    ELSE COUNT(*)
			END AS KOUNT 
			FROM MY_TABLE AS T1 WHERE T1.AMOUNT = AMOUNT
  $$
  ;

SELECT METRIC(1)








CREATE OR REPLACE FUNCTION COUNT_STAR_TABLE(T STRING) 
	RETURNS NUMBER 
	AS 
		'SELECT ROW_COUNT 
		FROM INFORMATION_SCHEMA.TABLES 
		WHERE TABLE_NAME = T
		AND TABLE_SCHEMA = CURRENT_SCHEMA()
		AND TABLE_CATALOG = CURRENT_DATABASE()';
        
SELECT COUNT_STAR_TABLE('METRIC')        
        
SELECT * FROM  "DEMO_DB"."INFORMATION_SCHEMA"        
        
        
CREATE OR REPLACE FUNCTION COUNT_STAR_TABLE(T STRING) 
	RETURNS NUMBER 
	AS 
		'SELECT COUNT(*) 
		FROM T 
		WHERE AMOUNT = 1';        
        
        
        
        
SELECT COUNT(*) FROM DEMO_DB.PUBLIC.MY_TABLE AS T1 WHERE T1.AMOUNT = 12



CREATE OR REPLACE TABLE SQL_STORE (SQL_ID NUMBER , SQL_TEXT VARCHAR(5000));	

SELECT * FROM SQL_STORE




CREATE OR REPLACE PROCEDURE SP(SQL_TEXT VARCHAR)
  RETURNS VARCHAR
  LANGUAGE javascript
  AS
  $$
  var rs = snowflake.execute( 
				  		{ 
				  			sqlText: SQL_TEXT
				       } 
       );
  return 'Done.';
  $$;

TRUNCATE TABLE METRIC

SELECT * FROM METRIC

TRUNCATE TABLE SQL_STORE
SELECT * FROM SQL_STORE

INSERT INTO SQL_STORE( SQL_ID , SQL_TEXT)
VALUES
(
    4001,
    'INSERT INTO   METRIC (TABLE_NAME , METRIC)' ||
    'VALUES' || 
    '( \'NAME\' , ( SELECT COUNT(*) FROM MY_TABLE WHERE NAME IN ( \'PARKASH\',\'parkash\' ) ) ) ,' ||
    '( \'NAME\' , ( SELECT COUNT(*) FROM MY_TABLE WHERE NAME = \'PARKASH\' ) ) ,' ||
    '( \'NAME\' , ( SELECT COUNT(*) FROM MY_TABLE WHERE AMOUNT = 10 ) ) ' 
)

CALL SP( SELECT SQL_TEXT FROM SQL_STORE )

CALL SP( 'SELECT COUNT(*) FROM DEMO_DB.PUBLIC.MY_TABLE AS T1 WHERE T1.AMOUNT = 1' )







CALL SP( SELECT SQL_TEXT FROM SQL_STORE )
CALL SP( SELECT SQL_TEXT FROM SQL_STORE )
CALL SP( SELECT SQL_TEXT FROM SQL_STORE )

TRUNCATE TABLE SQL_STORE
SELECT * FROM SQL_STORE
INSERT INTO SQL_STORE( SQL_ID , SQL_TEXT)
VALUES
(
    4001,
    'INSERT INTO   METRIC (TABLE_NAME , METRIC)' ||
    'VALUES' || 
    '( \'NAME\' , ( CALL SP(  \'SELECT COUNT(*) FROM MY_TABLE WHERE NAME IN ( \'PARKASH\',\'parkash\' \') ) ) ) ,' 
)



CALL SP( SELECT SQL_TEXT FROM SQL_STORE )






CALL SP(  'SELECT COUNT(*) FROM MY_TABLE WHERE NAME IN ( \'PARKASH\',\'parkash\' ) ') 



INSERT INTO   METRIC (TABLE_NAME , METRIC) 
VALUES( 'NAME' , ( CALL SP(  'SELECT COUNT(*) FROM MY_TABLE WHERE NAME IN ( \'PARKASH\',\'parkash\' ) ')  ) ) 


SELECT 
CASE WHEN (SELECT CASE WHEN COUNT(*) = 0 then 0 ELSE COUNT(*) END AS METRIC FROM MY_TABLE AS T1 WHERE T1.AMOUNT = 12) = FALSE THEN 0
ELSE (SELECT CASE WHEN COUNT(*) = 0 then 0 ELSE COUNT(*) END AS METRIC FROM MY_TABLE AS T1 WHERE T1.AMOUNT = 12)
END AS V
FROM DUAL


TRUNCATE TABLE METRIC
SELECT * FROM MY_TABLE
SELECT * FROM METRIC

INSERT INTO   METRIC (TABLE_NAME , METRIC)
VALUES 
( 'NAME' , ( SELECT COUNT(*) AS K FROM DEMO_DB.PUBLIC.MY_TABLE  AS T1 WHERE T1.NAME IN ( 'PARKASH','parkash' ) ) ) ,
( 'NAME' , ( SELECT COUNT(*) AS K FROM DEMO_DB.PUBLIC.MY_TABLE  AS T1 WHERE T1.NAME = 'PARKASH' ) ) ,
( 'NAME' , ( SELECT COUNT(*) AS K FROM DEMO_DB.PUBLIC.MY_TABLE  AS T1 WHERE T1.ID = 10 ) ) 




SELECT
	CASE WHEN ( ( SELECT COUNT(*) FROM MY_TABLE WHERE NAME IN ( 'PARKAS1H','par1kash' ) ) != TRUE ) THEN 0
	ELSE ( SELECT COUNT(*) FROM MY_TABLE WHERE NAME IN ( 'PARKAS1H','par1kash' )  )
	END AS METRIC
FROM DUAL  





INSERT INTO   METRIC (TABLE_NAME , METRIC)
VALUES 
( 'NAME' , ( SELECT	CASE WHEN ( ( SELECT COUNT(*) FROM MY_TABLE WHERE NAME IN ( 'PAR1KASH','par1kash' ) ) = FALSE ) THEN 0	ELSE ( SELECT COUNT(*) FROM MY_TABLE WHERE NAME IN ( 'PAR1KASH','pa1rkash' )  )	END AS METRIC FROM DUAL  ) )




----


CREATE OR REPLACE TABLE MY_TABLE (ID NUMBER , NAME VARCHAR(50));
INSERT INTO MY_TABLE VALUES(1 , 'PARKASH');
SELECT * FROM MY_TABLE;


CREATE OR REPLACE TABLE METRIC_TABLE (TABLE_NAME VARCHAR(50) ,  METRIC NUMBER   );

SELECT * FROM METRIC_TABLE;



INSERT INTO   METRIC_TABLE (TABLE_NAME , METRIC)
VALUES 
( 'NAME' , ( SELECT COUNT(*) FROM MY_TABLE WHERE NAME IN ( 'PARKASH','parkash' ) ) ) ,
( 'NAME' , ( SELECT COUNT(*) FROM MY_TABLE WHERE NAME = 'PARKASH' ) ) ,
( 'NAME' , ( SELECT COUNT(*) FROM MY_TABLE WHERE ID = 11 ) ) 



INSERT INTO   METRIC_TABLE (TABLE_NAME , METRIC)
VALUES 
( 'NAME' , ( SELECT	CASE WHEN ( SELECT COUNT(*) FROM MY_TABLE WHERE NAME IN ( 'PAR1KASH','par1kash' ) ) = FALSE THEN 0	ELSE ( SELECT COUNT(*) FROM MY_TABLE WHERE NAME IN ( 'PAR1KASH','pa1rkash' )  )	END AS METRIC FROM DUAL  ) )




SELECT * FROM METRIC_TABLE;
TRUNCATE TABLE METRIC_TABLE;

CALL SP( 'INSERT INTO   METRIC_TABLE (TABLE_NAME , METRIC) VALUES ( \'NAME\' , ( SELECT COUNT(*) FROM MY_TABLE WHERE NAME IN ( \'PARKASH\',\'parkash\' ) ) ) , ( \'NAME\' , ( SELECT COUNT(*) FROM MY_TABLE WHERE NAME = \'PARKASH\' ) ) , ( \'NAME\' , ( SELECT COUNT(*) FROM MY_TABLE WHERE ID = 1 ) )'   )

'INSERT INTO   METRIC_TABLE (TABLE_NAME , METRIC) VALUES ( \'NAME\' , ( SELECT COUNT(*) FROM MY_TABLE WHERE NAME IN ( \'PARKASH\',\'parkash\' ) ) ) , ( \'NAME\' , ( SELECT COUNT(*) FROM MY_TABLE WHERE NAME = \'PARKASH\' ) ) , ( \'NAME\' , ( SELECT COUNT(*) FROM MY_TABLE WHERE ID = 1 ) )' 
